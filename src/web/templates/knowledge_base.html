{% extends "base.html" %}
{% block title %}Knowledge Base - DALI Legal AI{% endblock %}
{% block content %}
<div class="main-header">
    <h1>ðŸ“š Knowledge Base</h1>
    <p>Search and manage your firm's legal knowledge base.</p>
</div>
<form method="post" action="/knowledge-base" style="margin-bottom:2rem;">
    <div style="margin-bottom:1rem;">
        <label for="search_query"><b>Search knowledge base:</b></label><br>
        <input type="text" id="search_query" name="search_query" value="{{ search_query or '' }}" style="width:100%;padding:0.5rem;" placeholder="Enter search terms or legal concepts...">
    </div>
    <div style="display:flex;gap:2rem;margin-bottom:1rem;">
        <div style="flex:1;">
            <label for="num_results"><b>Number of results:</b></label><br>
            <input type="range" id="num_results" name="num_results" min="1" max="20" value="{{ num_results or 5 }}" oninput="this.nextElementSibling.value = this.value">
            <output>{{ num_results or 5 }}</output>
        </div>
        <div style="flex:1;">
            <label for="min_score"><b>Minimum relevance score:</b></label><br>
            <input type="range" id="min_score" name="min_score" min="0" max="1" step="0.01" value="{{ min_score or 0.5 }}" oninput="this.nextElementSibling.value = this.value">
            <output>{{ min_score or 0.5 }}</output>
        </div>
    </div>
    <button type="submit" class="metric-card" style="width:100%;">ðŸ”Ž Search Knowledge Base</button>
</form>
{% if error %}<div class="error-message">{{ error }}</div>{% endif %}
{% if results %}
    <div style="font-weight:bold;font-size:1.1rem;margin-bottom:0.5rem;">Results</div>
    <div style="margin-bottom:1rem;">
        {% for result in results %}
            <details style="margin-bottom:0.5rem;">
                <summary><b>{{ result.metadata.title }}</b> (Score: {{ '%.2f' % result.score }})</summary>
                <div style="padding:0.5rem 1rem;">{{ result.content[:500] }}...</div>
            </details>
        {% endfor %}
    </div>
{% endif %}
<div style="font-weight:bold;font-size:1.1rem;margin-bottom:0.5rem;">Knowledge Base Statistics</div>
<div class="metric-card">ðŸ“„ Total Documents: {{ stats.total_documents }}</div>
<div class="metric-card">ðŸ“‘ Document Types: {{ stats.document_types|length }}</div>
<div class="metric-card">ðŸ”— Sources: {{ stats.sources|length }}</div>
{% if user and stats.total_documents > 0 %}
    <h3>Knowledge Base Documents</h3>
    <table class="metric-table" style="width:100%;margin-bottom:2rem;">
        <thead>
            <tr>
                <th>Title</th>
                <th>Type</th>
                <th>Source</th>
                <th>Uploaded</th>
            </tr>
        </thead>
        <tbody>
        {% for doc in documents %}
            <tr>
                <td>{{ doc.title }}</td>
                <td>{{ doc.document_type }}</td>
                <td>{{ doc.source }}</td>
                <td>{{ doc.created_at }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endif %}
{% endblock %}
